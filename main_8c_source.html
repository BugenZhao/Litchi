<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Litchi: main.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Litchi
   </div>
   <div id="projectbrief">Bugen&#39;s toy kernel</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('main_8c_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">main.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="main_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// Adopted from JOS/xv6</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160; </div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="x86_8h.html">include/x86.h</a>&gt;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="elf_8h.html">include/elf.h</a>&gt;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160; </div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">/**********************************************************************</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * This a dirt simple boot loader, whose sole job is to boot</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * an ELF kernel image from the first IDE hard disk.</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * DISK LAYOUT</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> *  * This program(boot.S and main.c) is the bootloader.  It should</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> *    be stored in the first sector of the disk.</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> *  * The 2nd sector onward holds the kernel image.</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> *  * The kernel image must be in ELF format.</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * BOOT UP STEPS</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> *  * when the CPU boots it loads the BIOS into memory and executes it</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> *  * the BIOS intializes devices, sets of the interrupt routines, and</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> *    reads the first sector of the boot device(e.g., hard-drive)</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> *    into memory and jumps to it.</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> *  * Assuming this boot loader is stored in the first sector of the</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> *    hard-drive, this code takes over...</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> *  * control starts in boot.S -- which sets up protected mode,</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> *    and a stack so C code then run, then calls bootmain()</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> *  * bootmain() in this file takes over, reads in the kernel and jumps to it.</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"> **********************************************************************/</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160; </div>
<div class="line"><a name="l00034"></a><span class="lineno"><a class="line" href="main_8c.html#af69dd8b281718a66b3e7a65250d24419">   34</a></span>&#160;<span class="preprocessor">#define SECTSIZE    512</span></div>
<div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="main_8c.html#a3bb20c9a153cc24ad25ef57d9e1e2db6">   35</a></span>&#160;<span class="preprocessor">#define ELFHDR        ((struct Elf *) 0x20000) // scratch space</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160; </div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="keywordtype">void</span> <a class="code" href="main_8c.html#a8bc2062a175b7c74607a2498ac997657">readsect</a>(<span class="keywordtype">void</span> *, uint32_t);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160; </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="keywordtype">void</span> <a class="code" href="main_8c.html#a687601dc22e8d4d8407608c91fd325eb">readseg</a>(uint32_t, uint32_t, uint32_t);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160; </div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="main_8c.html#a0d198d492591e1b70a8a12109408a7e4">   42</a></span>&#160;<a class="code" href="main_8c.html#a0d198d492591e1b70a8a12109408a7e4">bootmain</a>(<span class="keywordtype">void</span>) {</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="keyword">struct </span><a class="code" href="struct_proghdr.html">Proghdr</a> *ph, *eph;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160; </div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="comment">// read 1st page off disk into scratch space to get the header</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <a class="code" href="main_8c.html#a687601dc22e8d4d8407608c91fd325eb">readseg</a>((uint32_t) <a class="code" href="main_8c.html#a3bb20c9a153cc24ad25ef57d9e1e2db6">ELFHDR</a>, <a class="code" href="main_8c.html#af69dd8b281718a66b3e7a65250d24419">SECTSIZE</a> * 8, 0);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160; </div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="comment">// is this a valid ELF?</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="main_8c.html#a3bb20c9a153cc24ad25ef57d9e1e2db6">ELFHDR</a>-&gt;e_magic != <a class="code" href="elf_8h.html#abb1c2e5626667aacc7b3efd269a6c0eb">ELF_MAGIC</a>)</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        <span class="keywordflow">goto</span> bad;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; </div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="comment">// load each program segment (ignores ph flags)</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    ph = (<span class="keyword">struct </span><a class="code" href="struct_proghdr.html">Proghdr</a> *) ((uint8_t *) <a class="code" href="main_8c.html#a3bb20c9a153cc24ad25ef57d9e1e2db6">ELFHDR</a> + <a class="code" href="main_8c.html#a3bb20c9a153cc24ad25ef57d9e1e2db6">ELFHDR</a>-&gt;e_phoff);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    eph = ph + <a class="code" href="main_8c.html#a3bb20c9a153cc24ad25ef57d9e1e2db6">ELFHDR</a>-&gt;e_phnum;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keywordflow">for</span> (; ph &lt; eph; ph++)</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        <span class="comment">// p_pa is the load address of this segment (as well</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        <span class="comment">// as the physical address)</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        <a class="code" href="main_8c.html#a687601dc22e8d4d8407608c91fd325eb">readseg</a>(ph-&gt;<a class="code" href="struct_proghdr.html#a8e0696e5ec946b556740bf3d3337a0bf">p_pa</a>, ph-&gt;<a class="code" href="struct_proghdr.html#aa102946aa9cd74d117da3555a0fe624a">p_memsz</a>, ph-&gt;<a class="code" href="struct_proghdr.html#ab1fe5dd00451d3fcf2cd3aeb4a7354b8">p_offset</a>);</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160; </div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="comment">// call the entry point from the ELF header</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="comment">// note: does not return!</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    *(uint16_t *) 0xb809e = 0x0a4c;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    ((void (*)(void)) (<a class="code" href="main_8c.html#a3bb20c9a153cc24ad25ef57d9e1e2db6">ELFHDR</a>-&gt;e_entry))();</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160; </div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    bad:</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    *(uint16_t *) 0xb809e = 0x0c4c;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="comment">// BUGENC: bochs breakpoint port</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <a class="code" href="x86_8h.html#af92fc55c49437b9152499a13ba2b6585">outw</a>(0x8A00, 0x8A00);</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <a class="code" href="x86_8h.html#af92fc55c49437b9152499a13ba2b6585">outw</a>(0x8A00, 0x8E00);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="keywordflow">while</span> (1)</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        <span class="comment">/* do nothing */</span>;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;}</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160; </div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">// Read &#39;count&#39; bytes at &#39;offset&#39; from kernel into physical address &#39;pa&#39;.</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">// Might copy more than asked</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00077"></a><span class="lineno"><a class="line" href="main_8c.html#a687601dc22e8d4d8407608c91fd325eb">   77</a></span>&#160;<a class="code" href="main_8c.html#a687601dc22e8d4d8407608c91fd325eb">readseg</a>(uint32_t pa, uint32_t <a class="code" href="namespacestr.html#a062221f630647cf300f0dd982c4ed904">count</a>, uint32_t offset) {</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    uint16_t *statusPos = (uint16_t *) 0xb80a0;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    uint32_t end_pa;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160; </div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    end_pa = pa + <a class="code" href="namespacestr.html#a062221f630647cf300f0dd982c4ed904">count</a>;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160; </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="comment">// round down to sector boundary</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    pa &amp;= ~(<a class="code" href="main_8c.html#af69dd8b281718a66b3e7a65250d24419">SECTSIZE</a> - 1);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160; </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="comment">// translate from bytes to sectors, and kernel starts at sector 1</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    offset = (offset / <a class="code" href="main_8c.html#af69dd8b281718a66b3e7a65250d24419">SECTSIZE</a>) + 1;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160; </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="comment">// If this is too slow, we could read lots of sectors at a time.</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="comment">// We&#39;d write more to memory than asked, but it doesn&#39;t matter --</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="comment">// we load in increasing order.</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="keywordflow">while</span> (pa &lt; end_pa) {</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        <span class="comment">// Since we haven&#39;t enabled paging yet and we&#39;re using</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <span class="comment">// an identity segment mapping (see boot.S), we can</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <span class="comment">// use physical addresses directly.  This won&#39;t be the</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        <span class="comment">// case once JOS enables the MMU.</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        <a class="code" href="main_8c.html#a8bc2062a175b7c74607a2498ac997657">readsect</a>((uint8_t *) pa, offset);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        *(statusPos++) = 0x072e;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        pa += <a class="code" href="main_8c.html#af69dd8b281718a66b3e7a65250d24419">SECTSIZE</a>;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        offset++;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    }</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;}</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160; </div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00105"></a><span class="lineno"><a class="line" href="main_8c.html#a63222d4a07c38c198de5bd116a001935">  105</a></span>&#160;<a class="code" href="main_8c.html#a63222d4a07c38c198de5bd116a001935">waitdisk</a>(<span class="keywordtype">void</span>) {</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="comment">// wait for disk ready</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="comment">// floppy will be stuck here</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keywordflow">while</span> ((<a class="code" href="x86_8h.html#afdc603aa210ab8fd9995ce74940f5d7f">inb</a>(0x1F7) &amp; 0xC0) != 0x40)</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        <span class="comment">/* do nothing */</span>;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;}</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160; </div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00113"></a><span class="lineno"><a class="line" href="main_8c.html#a8bc2062a175b7c74607a2498ac997657">  113</a></span>&#160;<a class="code" href="main_8c.html#a8bc2062a175b7c74607a2498ac997657">readsect</a>(<span class="keywordtype">void</span> *dst, uint32_t offset) {</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="comment">// wait for disk to be ready</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <a class="code" href="main_8c.html#a63222d4a07c38c198de5bd116a001935">waitdisk</a>();</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160; </div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <a class="code" href="x86_8h.html#ade961b44e45ddacbc3c3b7609cf36dc6">outb</a>(0x1F2, 1);        <span class="comment">// count = 1</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <a class="code" href="x86_8h.html#ade961b44e45ddacbc3c3b7609cf36dc6">outb</a>(0x1F3, offset);</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <a class="code" href="x86_8h.html#ade961b44e45ddacbc3c3b7609cf36dc6">outb</a>(0x1F4, offset &gt;&gt; 8);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <a class="code" href="x86_8h.html#ade961b44e45ddacbc3c3b7609cf36dc6">outb</a>(0x1F5, offset &gt;&gt; 16);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <a class="code" href="x86_8h.html#ade961b44e45ddacbc3c3b7609cf36dc6">outb</a>(0x1F6, (offset &gt;&gt; 24) | 0xE0);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <a class="code" href="x86_8h.html#ade961b44e45ddacbc3c3b7609cf36dc6">outb</a>(0x1F7, 0x20);    <span class="comment">// cmd 0x20 - read sectors</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160; </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="comment">// wait for disk to be ready</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <a class="code" href="main_8c.html#a63222d4a07c38c198de5bd116a001935">waitdisk</a>();</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160; </div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="comment">// read a sector</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <a class="code" href="x86_8h.html#afa75519f8fc7778abeebd0b9bdc82569">insl</a>(0x1F0, dst, <a class="code" href="main_8c.html#af69dd8b281718a66b3e7a65250d24419">SECTSIZE</a> / 4);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;}</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160; </div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="anamespacemonitor_html"><div class="ttname"><a href="namespacemonitor.html">monitor</a></div><div class="ttdef"><b>Definition:</b> <a href="monitor_8cc_source.html#l00021">monitor.cc:21</a></div></div>
<div class="ttc" id="amain_8c_html_a3bb20c9a153cc24ad25ef57d9e1e2db6"><div class="ttname"><a href="main_8c.html#a3bb20c9a153cc24ad25ef57d9e1e2db6">ELFHDR</a></div><div class="ttdeci">#define ELFHDR</div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00035">main.c:35</a></div></div>
<div class="ttc" id="anamespacetask_html"><div class="ttname"><a href="namespacetask.html">task</a></div><div class="ttdef"><b>Definition:</b> <a href="include_2task_8hh_source.html#l00008">include/task.hh:8</a></div></div>
<div class="ttc" id="auser_2_c_make_files_2hello_8elf_8dir_2link_8txt_html_a8653a3759d4d3e8de749ded3565befb4"><div class="ttname"><a href="user_2_c_make_files_2hello_8elf_8dir_2link_8txt.html#a8653a3759d4d3e8de749ded3565befb4">elf_i386</a></div><div class="ttdeci">usr local bin i386 litchi elf g ffreestanding fno builtin nostdlib fno omit frame pointer elf_i386</div><div class="ttdef"><b>Definition:</b> <a href="user_2_c_make_files_2hello_8elf_8dir_2link_8txt_source.html#l00001">user/CMakeFiles/hello.elf.dir/link.txt:1</a></div></div>
<div class="ttc" id="a_c_make_c_compiler_id_8c_html_a0ddf1224851353fc92bfbff6f499fa97"><div class="ttname"><a href="_c_make_c_compiler_id_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a></div><div class="ttdeci">int main(int argc, char *argv[])</div><div class="ttdef"><b>Definition:</b> <a href="_c_make_c_compiler_id_8c_source.html#l00648">CMakeCCompilerId.c:648</a></div></div>
<div class="ttc" id="anamespaceconsole_1_1serial_html_a868eee5d379fb84ab4b7dc404b5419f8"><div class="ttname"><a href="namespaceconsole_1_1serial.html#a868eee5d379fb84ab4b7dc404b5419f8">console::serial::init</a></div><div class="ttdeci">static void init(void)</div><div class="ttdef"><b>Definition:</b> <a href="console_8cc_source.html#l00049">console.cc:49</a></div></div>
<div class="ttc" id="amain_8c_html_a0d198d492591e1b70a8a12109408a7e4"><div class="ttname"><a href="main_8c.html#a0d198d492591e1b70a8a12109408a7e4">bootmain</a></div><div class="ttdeci">void bootmain(void)</div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00042">main.c:42</a></div></div>
<div class="ttc" id="anamespaceirq__gen_html_a43fdd835105e2471f3341652c6c54d24"><div class="ttname"><a href="namespaceirq__gen.html#a43fdd835105e2471f3341652c6c54d24">irq_gen.o</a></div><div class="ttdeci">string o</div><div class="ttdef"><b>Definition:</b> <a href="irq__gen_8py_source.html#l00011">irq_gen.py:11</a></div></div>
<div class="ttc" id="aumain_8cc_html_a12093e98bb774fc08f967c7518af7c0f"><div class="ttname"><a href="umain_8cc.html#a12093e98bb774fc08f967c7518af7c0f">umain</a></div><div class="ttdeci">void umain(int argc, char **argv)</div><div class="ttdef"><b>Definition:</b> <a href="umain_8cc_source.html#l00010">umain.cc:10</a></div></div>
<div class="ttc" id="anamespacestr_html_a062221f630647cf300f0dd982c4ed904"><div class="ttname"><a href="namespacestr.html#a062221f630647cf300f0dd982c4ed904">str::count</a></div><div class="ttdeci">size_t count(const char *str)</div><div class="ttdef"><b>Definition:</b> <a href="string_8cc_source.html#l00105">string.cc:105</a></div></div>
<div class="ttc" id="anamespaceconsole_1_1in_html_afa763e7729f2e6fbdcf4c14e44ad7a29"><div class="ttname"><a href="namespaceconsole_1_1in.html#afa763e7729f2e6fbdcf4c14e44ad7a29">console::in::readline</a></div><div class="ttdeci">char * readline(const char *promptFmt=nullptr,...)</div><div class="ttdef"><b>Definition:</b> <a href="kernel_2readline_8cc_source.html#l00014">kernel/readline.cc:14</a></div></div>
<div class="ttc" id="auser_2_c_make_lists_8txt_html_a006bff9c64c212ace00a192412136a47"><div class="ttname"><a href="user_2_c_make_lists_8txt.html#a006bff9c64c212ace00a192412136a47">Wl</a></div><div class="ttdeci">PROPERTIES LINK_FLAGS Wl</div><div class="ttdef"><b>Definition:</b> <a href="user_2_c_make_lists_8txt_source.html#l00014">user/CMakeLists.txt:14</a></div></div>
<div class="ttc" id="amain_8c_html_a63222d4a07c38c198de5bd116a001935"><div class="ttname"><a href="main_8c.html#a63222d4a07c38c198de5bd116a001935">waitdisk</a></div><div class="ttdeci">void waitdisk(void)</div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00105">main.c:105</a></div></div>
<div class="ttc" id="amain_8c_html_a687601dc22e8d4d8407608c91fd325eb"><div class="ttname"><a href="main_8c.html#a687601dc22e8d4d8407608c91fd325eb">readseg</a></div><div class="ttdeci">void readseg(uint32_t, uint32_t, uint32_t)</div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00077">main.c:77</a></div></div>
<div class="ttc" id="anamespacetrap_html"><div class="ttname"><a href="namespacetrap.html">trap</a></div><div class="ttdef"><b>Definition:</b> <a href="include_2trap_8hh_source.html#l00012">include/trap.hh:12</a></div></div>
<div class="ttc" id="agdt_8c_html_a04ffa761b7c59150e5f5d0d4459e8ba5"><div class="ttname"><a href="gdt_8c.html#a04ffa761b7c59150e5f5d0d4459e8ba5">gdt</a></div><div class="ttdeci">struct SegDesc gdt[]</div><div class="ttdef"><b>Definition:</b> <a href="gdt_8c_source.html#l00001">gdt.c:15</a></div></div>
<div class="ttc" id="anamespacevmem_html"><div class="ttname"><a href="namespacevmem.html">vmem</a></div><div class="ttdef"><b>Definition:</b> <a href="vmem_8cc_source.html#l00019">vmem.cc:19</a></div></div>
<div class="ttc" id="akernel_2_c_make_files_2litchi_8elf_8dir_2link_8txt_html_a8653a3759d4d3e8de749ded3565befb4"><div class="ttname"><a href="kernel_2_c_make_files_2litchi_8elf_8dir_2link_8txt.html#a8653a3759d4d3e8de749ded3565befb4">elf_i386</a></div><div class="ttdeci">usr local bin i386 litchi elf g ffreestanding fno builtin nostdlib fno omit frame pointer elf_i386</div><div class="ttdef"><b>Definition:</b> <a href="kernel_2_c_make_files_2litchi_8elf_8dir_2link_8txt_source.html#l00001">kernel/CMakeFiles/litchi.elf.dir/link.txt:1</a></div></div>
<div class="ttc" id="aboot_2_c_make_files_2boot_8elf_8dir_2link_8txt_html_aa2df1e7800c6bb3ffd6180b2d0ac3901"><div class="ttname"><a href="boot_2_c_make_files_2boot_8elf_8dir_2link_8txt.html#aa2df1e7800c6bb3ffd6180b2d0ac3901">Ttext</a></div><div class="ttdeci">usr local bin i386 litchi elf gcc ffreestanding fno builtin nostdlib fno omit frame static pointer Wall Wno format Wno unused Wno pointer arith Werror m32 fno tree ch fno stack protector g ggdb isysroot Applications Xcode_11 app Contents Developer Platforms MacOSX platform Developer SDKs MacOSX10 sdk Ttext</div><div class="ttdef"><b>Definition:</b> <a href="boot_2_c_make_files_2boot_8elf_8dir_2link_8txt_source.html#l00001">boot/CMakeFiles/boot.elf.dir/link.txt:1</a></div></div>
<div class="ttc" id="aboot_2_c_make_files_2boot_8elf_8dir_2link_8txt_html_ae5af299cbcf1adaf5c8bd371d1c54aed"><div class="ttname"><a href="boot_2_c_make_files_2boot_8elf_8dir_2link_8txt.html#ae5af299cbcf1adaf5c8bd371d1c54aed">e</a></div><div class="ttdeci">usr local bin i386 litchi elf gcc ffreestanding fno builtin nostdlib fno omit frame static pointer Wall Wno format Wno unused Wno pointer arith Werror m32 fno tree ch fno stack protector g ggdb isysroot Applications Xcode_11 app Contents Developer Platforms MacOSX platform Developer SDKs MacOSX10 sdk e</div><div class="ttdef"><b>Definition:</b> <a href="boot_2_c_make_files_2boot_8elf_8dir_2link_8txt_source.html#l00001">boot/CMakeFiles/boot.elf.dir/link.txt:1</a></div></div>
<div class="ttc" id="aelf_8h_html"><div class="ttname"><a href="elf_8h.html">elf.h</a></div></div>
<div class="ttc" id="anamespacemp_html"><div class="ttname"><a href="namespacemp.html">mp</a></div><div class="ttdef"><b>Definition:</b> <a href="mp_8cc_source.html#l00014">mp.cc:14</a></div></div>
<div class="ttc" id="auser_2_c_make_files_2hello_8elf_8dir_2link_8txt_html_ab0176f2c122cba04868039de46fc58fa"><div class="ttname"><a href="user_2_c_make_files_2hello_8elf_8dir_2link_8txt.html#ab0176f2c122cba04868039de46fc58fa">m</a></div><div class="ttdeci">usr local bin i386 litchi elf g ffreestanding fno builtin nostdlib fno omit frame pointer m</div><div class="ttdef"><b>Definition:</b> <a href="user_2_c_make_files_2hello_8elf_8dir_2link_8txt_source.html#l00001">user/CMakeFiles/hello.elf.dir/link.txt:1</a></div></div>
<div class="ttc" id="ax86_8h_html_ade961b44e45ddacbc3c3b7609cf36dc6"><div class="ttname"><a href="x86_8h.html#ade961b44e45ddacbc3c3b7609cf36dc6">outb</a></div><div class="ttdeci">static void outb(int port, uint8_t data)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8h_source.html#l00069">x86.h:69</a></div></div>
<div class="ttc" id="aboot_2_c_make_files_2boot_8elf_8dir_2link_8txt_html_a2c50c55711db0f5b01609a6d3554a1b7"><div class="ttname"><a href="boot_2_c_make_files_2boot_8elf_8dir_2link_8txt.html#a2c50c55711db0f5b01609a6d3554a1b7">N</a></div><div class="ttdeci">usr local bin i386 litchi elf gcc ffreestanding fno builtin nostdlib fno omit frame static pointer Wall Wno format Wno unused Wno pointer arith Werror m32 fno tree ch fno stack protector g ggdb isysroot Applications Xcode_11 app Contents Developer Platforms MacOSX platform Developer SDKs MacOSX10 sdk N</div><div class="ttdef"><b>Definition:</b> <a href="boot_2_c_make_files_2boot_8elf_8dir_2link_8txt_source.html#l00001">boot/CMakeFiles/boot.elf.dir/link.txt:1</a></div></div>
<div class="ttc" id="ax86_8h_html"><div class="ttname"><a href="x86_8h.html">x86.h</a></div></div>
<div class="ttc" id="amain_8c_html_af69dd8b281718a66b3e7a65250d24419"><div class="ttname"><a href="main_8c.html#af69dd8b281718a66b3e7a65250d24419">SECTSIZE</a></div><div class="ttdeci">#define SECTSIZE</div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00034">main.c:34</a></div></div>
<div class="ttc" id="astruct_proghdr_html_a8e0696e5ec946b556740bf3d3337a0bf"><div class="ttname"><a href="struct_proghdr.html#a8e0696e5ec946b556740bf3d3337a0bf">Proghdr::p_pa</a></div><div class="ttdeci">uint32_t p_pa</div><div class="ttdef"><b>Definition:</b> <a href="elf_8h_source.html#l00031">elf.h:31</a></div></div>
<div class="ttc" id="anamespaceconsole_html"><div class="ttname"><a href="namespaceconsole.html">console</a></div><div class="ttdef"><b>Definition:</b> <a href="stdin_8hh_source.html#l00012">stdin.hh:12</a></div></div>
<div class="ttc" id="auser_2_c_make_files_2hello_8elf_8dir_2link_8txt_html_a6c93d0d3358e716d782b4cd4c465ab4d"><div class="ttname"><a href="user_2_c_make_files_2hello_8elf_8dir_2link_8txt.html#a6c93d0d3358e716d782b4cd4c465ab4d">T</a></div><div class="ttdeci">usr local bin i386 litchi elf g ffreestanding fno builtin nostdlib fno omit frame pointer T</div><div class="ttdef"><b>Definition:</b> <a href="user_2_c_make_files_2hello_8elf_8dir_2link_8txt_source.html#l00001">user/CMakeFiles/hello.elf.dir/link.txt:1</a></div></div>
<div class="ttc" id="aelf_8h_html_abb1c2e5626667aacc7b3efd269a6c0eb"><div class="ttname"><a href="elf_8h.html#abb1c2e5626667aacc7b3efd269a6c0eb">ELF_MAGIC</a></div><div class="ttdeci">#define ELF_MAGIC</div><div class="ttdef"><b>Definition:</b> <a href="elf_8h_source.html#l00006">elf.h:6</a></div></div>
<div class="ttc" id="anamespacekdebug_html"><div class="ttname"><a href="namespacekdebug.html">kdebug</a></div><div class="ttdef"><b>Definition:</b> <a href="kdebug_8cc_source.html#l00010">kdebug.cc:10</a></div></div>
<div class="ttc" id="ax86_8h_html_afa75519f8fc7778abeebd0b9bdc82569"><div class="ttname"><a href="x86_8h.html#afa75519f8fc7778abeebd0b9bdc82569">insl</a></div><div class="ttdeci">static void insl(int port, void *addr, int cnt)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8h_source.html#l00060">x86.h:60</a></div></div>
<div class="ttc" id="amain_8c_html_a8bc2062a175b7c74607a2498ac997657"><div class="ttname"><a href="main_8c.html#a8bc2062a175b7c74607a2498ac997657">readsect</a></div><div class="ttdeci">void readsect(void *, uint32_t)</div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00113">main.c:113</a></div></div>
<div class="ttc" id="aboot_2_c_make_files_2boot_8elf_8dir_2link_8txt_html_a7cf9b97a9edc5f5846cf1747cef2d404"><div class="ttname"><a href="boot_2_c_make_files_2boot_8elf_8dir_2link_8txt.html#a7cf9b97a9edc5f5846cf1747cef2d404">Wl</a></div><div class="ttdeci">usr local bin i386 litchi elf gcc ffreestanding fno builtin nostdlib fno omit frame static pointer Wall Wno format Wno unused Wno pointer arith Werror m32 fno tree ch fno stack protector g ggdb isysroot Applications Xcode_11 app Contents Developer Platforms MacOSX platform Developer SDKs MacOSX10 sdk Wl</div><div class="ttdef"><b>Definition:</b> <a href="boot_2_c_make_files_2boot_8elf_8dir_2link_8txt_source.html#l00001">boot/CMakeFiles/boot.elf.dir/link.txt:1</a></div></div>
<div class="ttc" id="akernel_2_c_make_files_2litchi_8elf_8dir_2link_8txt_html_ab0176f2c122cba04868039de46fc58fa"><div class="ttname"><a href="kernel_2_c_make_files_2litchi_8elf_8dir_2link_8txt.html#ab0176f2c122cba04868039de46fc58fa">m</a></div><div class="ttdeci">usr local bin i386 litchi elf g ffreestanding fno builtin nostdlib fno omit frame pointer m</div><div class="ttdef"><b>Definition:</b> <a href="kernel_2_c_make_files_2litchi_8elf_8dir_2link_8txt_source.html#l00001">kernel/CMakeFiles/litchi.elf.dir/link.txt:1</a></div></div>
<div class="ttc" id="aboot_2_c_make_files_2boot_8elf_8dir_2link_8txt_html_ab039c388e07303e0ff10fe1746447a4b"><div class="ttname"><a href="boot_2_c_make_files_2boot_8elf_8dir_2link_8txt.html#ab039c388e07303e0ff10fe1746447a4b">elf_i386</a></div><div class="ttdeci">usr local bin i386 litchi elf gcc ffreestanding fno builtin nostdlib fno omit frame static pointer Wall Wno format Wno unused Wno pointer arith Werror m32 fno tree ch fno stack protector g ggdb isysroot Applications Xcode_11 app Contents Developer Platforms MacOSX platform Developer SDKs MacOSX10 sdk elf_i386</div><div class="ttdef"><b>Definition:</b> <a href="boot_2_c_make_files_2boot_8elf_8dir_2link_8txt_source.html#l00001">boot/CMakeFiles/boot.elf.dir/link.txt:1</a></div></div>
<div class="ttc" id="aboot_2_c_make_files_2boot_8elf_8dir_2link_8txt_html_a7c3b2f09dcf537e91bd6dc3186c388fc"><div class="ttname"><a href="boot_2_c_make_files_2boot_8elf_8dir_2link_8txt.html#a7c3b2f09dcf537e91bd6dc3186c388fc">m</a></div><div class="ttdeci">usr local bin i386 litchi elf gcc ffreestanding fno builtin nostdlib fno omit frame static pointer Wall Wno format Wno unused Wno pointer arith Werror m32 fno tree ch fno stack protector g ggdb isysroot Applications Xcode_11 app Contents Developer Platforms MacOSX platform Developer SDKs MacOSX10 sdk m</div><div class="ttdef"><b>Definition:</b> <a href="boot_2_c_make_files_2boot_8elf_8dir_2link_8txt_source.html#l00001">boot/CMakeFiles/boot.elf.dir/link.txt:1</a></div></div>
<div class="ttc" id="anamespacestd_html"><div class="ttname"><a href="namespacestd.html">std</a></div><div class="ttdef"><b>Definition:</b> <a href="exception_8cc_source.html#l00007">exception.cc:7</a></div></div>
<div class="ttc" id="anamespaceksyscall_html"><div class="ttname"><a href="namespaceksyscall.html">ksyscall</a></div><div class="ttdef"><b>Definition:</b> <a href="syscall_8hh_source.html#l00010">syscall.hh:10</a></div></div>
<div class="ttc" id="astruct_proghdr_html"><div class="ttname"><a href="struct_proghdr.html">Proghdr</a></div><div class="ttdef"><b>Definition:</b> <a href="elf_8h_source.html#l00027">elf.h:27</a></div></div>
<div class="ttc" id="akernel_2_c_make_files_2litchi_8elf_8dir_2link_8txt_html_a6c93d0d3358e716d782b4cd4c465ab4d"><div class="ttname"><a href="kernel_2_c_make_files_2litchi_8elf_8dir_2link_8txt.html#a6c93d0d3358e716d782b4cd4c465ab4d">T</a></div><div class="ttdeci">usr local bin i386 litchi elf g ffreestanding fno builtin nostdlib fno omit frame pointer T</div><div class="ttdef"><b>Definition:</b> <a href="kernel_2_c_make_files_2litchi_8elf_8dir_2link_8txt_source.html#l00001">kernel/CMakeFiles/litchi.elf.dir/link.txt:1</a></div></div>
<div class="ttc" id="astruct_proghdr_html_aa102946aa9cd74d117da3555a0fe624a"><div class="ttname"><a href="struct_proghdr.html#aa102946aa9cd74d117da3555a0fe624a">Proghdr::p_memsz</a></div><div class="ttdeci">uint32_t p_memsz</div><div class="ttdef"><b>Definition:</b> <a href="elf_8h_source.html#l00033">elf.h:33</a></div></div>
<div class="ttc" id="astruct_proghdr_html_ab1fe5dd00451d3fcf2cd3aeb4a7354b8"><div class="ttname"><a href="struct_proghdr.html#ab1fe5dd00451d3fcf2cd3aeb4a7354b8">Proghdr::p_offset</a></div><div class="ttdeci">uint32_t p_offset</div><div class="ttdef"><b>Definition:</b> <a href="elf_8h_source.html#l00029">elf.h:29</a></div></div>
<div class="ttc" id="ax86_8h_html_af92fc55c49437b9152499a13ba2b6585"><div class="ttname"><a href="x86_8h.html#af92fc55c49437b9152499a13ba2b6585">outw</a></div><div class="ttdeci">static void outw(int port, uint16_t data)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8h_source.html#l00084">x86.h:84</a></div></div>
<div class="ttc" id="ax86_8h_html_afdc603aa210ab8fd9995ce74940f5d7f"><div class="ttname"><a href="x86_8h.html#afdc603aa210ab8fd9995ce74940f5d7f">inb</a></div><div class="ttdeci">static uint8_t inb(int port)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8h_source.html#l00018">x86.h:18</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_c6de2f74713c48eed6d43b177f196072.html">boot</a></li><li class="navelem"><a class="el" href="main_8c.html">main.c</a></li>
    <li class="footer">Generated by <a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
